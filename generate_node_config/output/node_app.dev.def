Bootstrap: docker
From: node:18-alpine

%environment
    # Used for user-specific data files. Intended for important, persistent data that should be preserved.
    export XDG_DATA_HOME="~/.local/share"
    
    # Used for non-essential, cached data. Can be deleted without loss of important information.
    export XDG_CACHE_HOME="~/.cache"
    
    # Used for temporary runtime files and other file objects. Cleared on reboot, not intended for persistent data.
    export XDG_RUNTIME_DIR="/run/user/$UID"

    # Used for persistent state data. Includes things like logs, history, and application state.
    export XDG_STATE_HOME="~/.local/state"

    # Used for user-specific configuration files.
    export XDG_CONFIG_HOME="~/.config"

%files
    ./* /app/

%post
    echo "apptainer: node_app.dev.def %post"
    cd /app

    echo "apptainer: npm install"
    npm install || (echo "Failed to install dependencies" && exit 1)

    echo "apptainer: clean up npm cache to reduce image size"
    npm cache clean --force

    echo "apptainer: npm dependencies have been installed and npm cache cleaned"

%runscript
    echo "apptainer: node_app.dev.def %runscript"
    echo "apptainer: cd /app && npm run dev"
    cd /app
    npm run dev

%labels
    Author 1nf053c
    Version 1.0
    Description "Container for generating Node.js project files."

%test
    # Test to ensure the container is working correctly
    test -d /app/node_modules
