Bootstrap: docker
From: node:20-alpine

%files
    ./environment.sh /environment.sh
    ./input/* /input/

%post
    source /environment.sh
    cp /input/* ${COMPUTE_INPUTDIR}/

    whoami
    pwd
    ls -l $(pwd)
    echo $PATH

    apk update
    apk add --no-cache \
    build-base \
    linux-headers \
    libseccomp-dev \
    glib-dev \
    cryptsetup-dev \
    squashfs-tools \
    fakeroot \
    git \
    bash \
    go \
    apptainer

    export APPTAINERENV_COMPUTE_INPUTDIR=${COMPUTE_INPUTDIR}

    apptainer build -F ${COMPUTE_OUTPUTDIR}/filemeta.sif ${COMPUTE_INPUTDIR}/filemeta.def

%runscript
    apptainer run --containall ${COMPUTE_OUTPUTDIR}/filemeta.sif

%labels
    Author 1nf053c
    Version 1.0
    Description "Container for compute"
