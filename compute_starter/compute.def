Bootstrap: docker
From: node:20-alpine

%files
    ./input/{*,.gitignore} /input/

%post
    export APPTAINER_TMPDIR="/scif/tmp"
    mkdir -p "${APPTAINER_TMPDIR}"
    mkdir -p /scif/apps/compute/data/input/
    mkdir -p /scif/apps/compute/data/output/

    cp /input/* /scif/apps/compute/data/input/
    cp /input/.gitignore /scif/apps/compute/data/input/

    whoami
    pwd
    ls -l /scif/apps/compute

    apk update
    apk add --no-cache \
    build-base \
    linux-headers \
    libseccomp-dev \
    glib-dev \
    cryptsetup-dev \
    squashfs-tools \
    fakeroot \
    git \
    bash \
    go \
    apptainer

    apptainer build -F /scif/apps/compute/data/output/app.sif /scif/apps/compute/data/input/app.def

%runscript
    apptainer run --fakeroot --writable-tmpfs /scif/apps/compute/data/output/app.sif

%labels
    Author 1nf053c
    Version 1.0
    Description "Container for compute"
