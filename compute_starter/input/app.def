Bootstrap: docker
From: node:20-alpine

%files
    /scif/apps/compute/data/input/{*,.gitignore} /scif/apps/filemeta/src/

%post
    whoami
    cd /scif/apps/filemeta/src/
    ls -l ./
    pwd

    apk add --no-cache sqlite

    npm install -g npm@latest
    npm init -y
    npm cache clean --force
    rm -rf node_modules/ package-lock.json
    npm i -D typescript ts-node @faker-js/faker @types/node prisma
    npm i @prisma/client ts-runtime-checks ts-patch
    npx ts-patch install

    mkdir -p ./prisma
    mv ./schema.prisma ./prisma/schema.prisma
    rm -rf ./prisma/migrations
    npx prisma migrate reset -f
    npx prisma generate
    npx prisma migrate dev --name init

%runscript
    ls -l /scif/apps/filemeta/src
    cd /scif/apps/filemeta/src
    mv .gitignore ..
    cd /scif/apps/filemeta
    echo "filemeta dir:"
    echo "/scif/apps/filemeta"

%labels
    Author 1nf053c
    Version 1.0
    Description "Container for Node.js and sqlite"
